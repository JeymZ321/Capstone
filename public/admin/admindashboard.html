<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>Dashboard - Admin</title>
    <link rel="icon" type="image/png" sizes="32x32" href="assets/img/reynaldoslogo.png">
    <link rel="stylesheet" href="assets/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i">
    <link rel="stylesheet" href="assets/fonts/fontawesome-all.min.css">
    <link rel="stylesheet" href="assets/fonts/font-awesome.min.css">
    <link rel="stylesheet" href="assets/fonts/fontawesome5-overrides.min.css">
    <link rel="stylesheet" href="assets/css/admin.css">

    <style>
        .black{
            background-color: rgb(72, 5, 5);
        }

        /* Add padding to the table cells */
        table.table th, 
        table.table td {
            padding: 10px 15px; /* Top/Bottom: 10px, Left/Right: 15px */
        }

        /* 
#chatbot {
  position: fixed;
  bottom: 20px;
  right: 20px;
  z-index: 1000;
}

#chatbotToggle {
  background-color: #051129;
  border: none;
  border-radius: 50%;
  width: 60px;
  height: 60px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
}

#chatbox {
  position: fixed;
  bottom: 90px;
  right: 20px;
  width: 300px;
  background: white;
  border-radius: 8px;
  display: none;
  flex-direction: column;
}

#chatHeader {
  background-color: #051129;
  color: white;
  padding: 10px;
  border-radius: 8px 8px 0 0;
}
*/

        
    </style>
</head>

<body id="page-top">
    <div id="wrapper">
        <nav class="navbar navbar-dark align-items-start sidebar sidebar-dark accordion bg-gradient-primary p-0" style="background: rgb(0,0,0);max-width: none;width: 120px;">
            <div class="container-fluid d-flex flex-column p-0"><a class="navbar-brand d-flex justify-content-center align-items-center sidebar-brand m-0" href="#" style="background: url('/assets/img/reynaldoslogo.png') no-repeat;background-size: contain;border-radius: 40px;width: 120px;height: 120px;">
                    <div class="sidebar-brand-icon rotate-n-15"></div>
                    <div class="sidebar-brand-text mx-3"></div>
                </a>
                <hr class="sidebar-divider my-0">
                <ul class="navbar-nav text-light" id="accordionSidebar">
                    <li class="nav-item">
                        <a class="nav-link active" href="admindashboard.html">
                            <i class="fas fa-tachometer-alt"></i>
                            <span>Dashboard</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="calendar.html">
                            <i class="fa fa-calendar"></i>
                            <span>Calendar</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" data-bs-toggle="collapse" data-bs-target="#appointmentDropdown" aria-expanded="false" aria-controls="appointmentDropdown">
                            <i class="fas fa-table"></i>
                            <span>Appointments</span>
                        </a>
                        <div id="appointmentDropdown" class="collapse" aria-labelledby="headingAppointment" data-bs-parent="#accordionSidebar">
                            <div class="bg-white py-2 collapse-inner rounded">
                                <a class="collapse-item" href="/display/appointment">Pending Requests</a>
                                <a class="collapse-item" href="/display/approved">Approved Requests</a>
                                <a class="collapse-item" href="/display/archives">Archives</a>
                            </div>
                        </div>
                    </li>

                    <li class="nav-item">
                        <a class="nav-link" href="mechanics.html">
                            <i class="fas fa-id-card"></i>
                            <span>Mechanics</span>
                        </a>
                    </li>
                    
                    <li class="nav-item">
                        <a class="nav-link" href="profile.html">
                            <i class="fas fa-user"></i>
                            <span>Profile</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" data-bs-toggle="collapse" data-bs-target="#cmsDropdown" aria-expanded="false" aria-controls="cmsDropdown">
                            <i class="fas fa-book"></i>
                            <span>CMS</span>
                        </a>
                        <div id="cmsDropdown" class="collapse" aria-labelledby="headingAppointment" data-bs-parent="#accordionSidebar">
                            <div class="bg-white py-2 collapse-inner">
                                <a class="collapse-item" href=" ">Gallery</a>
                                <a class="collapse-item" href="service.html">Service Management</a>
                                <a class="collapse-item" href="carmodels.html">Car Model Management</a>
                            </div>
                        </div>
                    </li>
                </ul>
                <div class="text-center d-none d-md-inline">
                    <button class="btn rounded-circle border-0" id="sidebarToggle" type="button"></button>
                </div>
            </div>
        </nav>
        
        <div class="d-flex flex-column" id="content-wrapper">
            <div id="content">
                <nav class="navbar navbar-light navbar-expand shadow mb-4 topbar static-top" style="background: rgb(0,0,0);">
                    <div class="container-fluid">
                        <button class="btn btn-link d-md-none rounded-circle me-3" id="sidebarToggleTop" type="button">
                            <i class="fas fa-bars"></i>
                        </button>
                        

                        <ul class="navbar-nav flex-nowrap ms-auto">
                            
                            <div class="d-none d-sm-block topbar-divider"></div>
                            <li class="nav-item dropdown no-arrow">
                                <div class="nav-item dropdown no-arrow"><a class="dropdown-toggle nav-link" aria-expanded="false" data-bs-toggle="dropdown" href="#"><span class="d-none d-lg-inline me-2 small" style="color: rgb(255,255,255);">Reynaldo's Car Care</span><img class="border rounded-circle img-profile" src="/assets/img/reynaldoslogo.png"></a>
                                    <div class="dropdown-menu shadow dropdown-menu-end animated--grow-in">
                                        <a class="dropdown-item" href="profile.html"><i class="fas fa-user fa-sm fa-fw me-2 text-gray-400"></i>&nbsp;Profile</a>
                                        <div class="dropdown-divider"></div>
                                        <a class="dropdown-item" href="login.html"><i class="fas fa-sign-out-alt fa-sm fa-fw me-2 text-gray-400"></i>&nbsp;Logout</a>
                                    </div>
                                </div>
                            </li>
                        </ul>
                    </div>
                </nav>

                <div class="container-fluid">
                    <div class="d-sm-flex justify-content-between align-items-center mb-4">
                        <h3 class="text-dark mb-0" style="font-weight: bold;">Dashboard</h3><!--<a class="btn btn-primary btn-sm d-none d-sm-inline-block" role="button" href="#"><i class="fas fa-download fa-sm text-white-50"></i>&nbsp;Generate Report</a>-->
                    </div>
                    <div class="row">

                        <div class="col-md-6 col-xl-2 mb-4">
                            <div class="card shadow border-start-success py-2 black">
                                <div class="card-body">
                                    <div class="row align-items-center no-gutters">
                                        <div class="col me-2">
                                            <div class="text-uppercase fw-bold text-xs mb-1" style="color: #aeaeff;"><span>Registered Customers</span></div>
                                            <div class="text-light fw-bold h5 mb-0 value"><span>0</span></div>
                                        </div>
                                        <div class="col-auto"><i class="fas fa-users fa-2x text-light"></i></div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        
                        <div class="col-md-6 col-xl-2 mb-4">
                            <a href="service.html" class="text-decoration-none">
                            <div class="card shadow border-start-success py-2 black">
                                <div class="card-body ">
                                    <div class="row align-items-center no-gutters">
                                        <div class="col me-2">
                                            <div class="text-uppercase fw-bold text-xs mb-1" style="color: #aeaeff;"><span>Services Offered</span></div>
                                            <div class="text-light fw-bold h5 mb-0"><span>0</span></div>
                                        </div>
                                        <div class="col-auto"><i class="fas fa-shopping-cart fa-2x text-light"></i></div>
                                    </div>
                                </div>
                            </div>
                            </a>
                        </div>
                        

                        <div class="col-md-6 col-xl-2 mb-4">
                            <a href="mechanics.html" class="text-decoration-none">
                            <div class="card shadow border-start-success py-2 black">
                                <div class="card-body">
                                    <div class="row align-items-center no-gutters">
                                        <div class="col me-2">
                                            <div class="text-uppercase fw-bold text-xs mb-1" style="color: #aeaeff;"><span>No. of Mechanics</span></div>
                                            <div class="text-light fw-bold h5 mb-0"><span>0</span></div>
                                        </div>
                                        <div class="col-auto"><i class="fas fa-user fa-2x text-light"></i></div>
                                    </div>
                                </div>
                            </div>
                            </a>
                        </div>


                        <div class="col-md-6 col-xl-2 mb-4">
                            <a href="/display/appointment" class="text-decoration-none">
                            <div class="card shadow border-start-warning py-2 black">
                                <div class="card-body">
                                    <div class="row align-items-center no-gutters">
                                        <div class="col me-2">
                                            <div class="text-uppercase fw-bold text-xs mb-1" style="color: #F3DFA2;"><span>Pending Requests</span></div>
                                            <div class="text-light fw-bold h5 mb-0"><span>0</span></div>
                                        </div>
                                        <div class="col-auto"><i class="fas fa-comments fa-2x text-light"></i></div>
                                    </div>
                                </div>
                            </div>
                            </a>
                        </div>

                        <div class="col-md-6 col-xl-2 mb-4">
                            <a href="/display/approved" class="text-decoration-none">
                            <div class="card shadow border-start-primary py-2 black">
                                <div class="card-body">
                                    <div class="row align-items-center no-gutters ">
                                        <div class="col me-2">
                                            <div class="text-uppercase fw-bold text-xs mb-1" style="color: #88ff70;"><span>Approved Appointments</span></div>
                                            <div class="text-light fw-bold h5 mb-0"><span>0</span></div>
                                        </div>
                                        <div class="col-auto"><i class="fas fa-calendar fa-2x text-light"></i></div>
                                    </div>
                                </div>
                            </div>
                            </a>
                        </div>
                        
                        <div class="col-md-6 col-xl-2 mb-4">
                            <a href="/display/archives" class="text-decoration-none">
                            <div class="card shadow border-start-info py-2 black">
                                <div class="card-body">
                                    <div class="row align-items-center no-gutters">
                                        <div class="col me-2">
                                            <div class="text-uppercase fw-bold text-xs mb-1" style="color: #ff6565;"><span>Archived Appointments</span></div>
                                            <div class="text-light fw-bold h5 mb-0"><span>0</span></div>
                                        </div>
                                        <div class="col-auto"><i class="fas fa-archive fa-2x text-light"></i></div>
                                    </div>
                                </div>
                            </div>
                            </a>
                        </div>
                        
                    </div>
                    <div class="row">
                        <div class="col-lg-7 col-xl-8">
                            <div class="card shadow mb-4">
                                <div class="card-header d-flex justify-content-between align-items-center" style="background-color: darkred;">
                                    <h6 class="text-light fw-bold m-0">Number of Car Care Center Visitors</h6>
                                    <div class="dropdown no-arrow">
                                        <button class="btn btn-link btn-sm dropdown-toggle" aria-expanded="false" data-bs-toggle="dropdown" type="button">
                                            <i class="fas fa-ellipsis-v text-gray-400"></i>
                                        </button>
                                        <div class="dropdown-menu shadow dropdown-menu-end animated--fade-in">
                                            <p class="text-center dropdown-header">dropdown header:</p>
                                            <a class="dropdown-item" href="#">&nbsp;Action</a>
                                            <a class="dropdown-item" href="#">&nbsp;Another action</a>
                                            <div class="dropdown-divider"></div>
                                            <a class="dropdown-item" href="#">&nbsp;Something else here</a>
                                        </div>
                                    </div>
                                </div>
                                <div class="card-body">
                                    <div class="chart-area">
                                        <canvas data-bss-chart='{
                                           "type":"bar",
                                           "data":{
                                              "labels":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug"],
                                              "datasets":[{
                                                 "label":"Earnings",
                                                 "fill":true,
                                                 "data":[0,10000,5000,15000,10000,20000,15000,25000],
                                                 "backgroundColor":"#FBABAA",
                                                 "borderColor":"#000",
                                                 "borderWidth": 1
                                              }]
                                           },
                                           "options":{
                                              "maintainAspectRatio":false,
                                              "legend":{"display":false},
                                              "scales":{
                                                 "xAxes":[{"ticks":{"beginAtZero":true}}],
                                                 "yAxes":[{"ticks":{"beginAtZero":true}}]
                                              }
                                           }
                                        }'></canvas>
                                     </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-lg-5 col-xl-4">
                            <div class="card shadow mb-4">
                                <div class="card-header d-flex justify-content-between align-items-center" style="background-color: darkred;">
                                    <h6 class="text-primary fw-bold m-0 text-light" >Customers Based on Municipality</h6>
                                    <div class="dropdown no-arrow"><button class="btn btn-link btn-sm dropdown-toggle" aria-expanded="false" data-bs-toggle="dropdown" type="button"><i class="fas fa-ellipsis-v text-gray-400"></i></button>
                                        <div class="dropdown-menu shadow dropdown-menu-end animated--fade-in">
                                            <p class="text-center dropdown-header">dropdown header:</p><a class="dropdown-item" href="#">&nbsp;Action</a><a class="dropdown-item" href="#">&nbsp;Another action</a>
                                            <div class="dropdown-divider"></div><a class="dropdown-item" href="#">&nbsp;Something else here</a>
                                        </div>
                                    </div>
                                </div>
                                <div class="card-body">
                                    <div class="chart-area">
                                        <canvas data-bss-chart='{
                                           "type":"pie",
                                           "data":{
                                              "labels":["Marikina","San Mateo","Antipolo", "Cainta", "Pasig", "Others"],
                                              "datasets":[{
                                                 "label":"",
                                                 "backgroundColor":["#FE5F55","#577399","#BDD5EA", "#BABAFF", "#FBABAA", "#495867"],
                                                 "borderColor":["#fff","#fff","#fff","#fff","#fff","#fff"],
                                                 "data":[55,23,16,14,33,16]
                                              }]
                                           },
                                           "options":{
                                              "maintainAspectRatio":false,
                                              "legend":{"display":true}
                                           }
                                        }'></canvas>
                                     </div>                                     
                                </div>
                            </div>
                        </div>

                        <div class="col-lg-5 col-xl-4">
                            <div class="card shadow mb-4">
                                <div class="card-header d-flex justify-content-between align-items-center" style="background-color: darkred;">
                                    <h6 class="text-primary fw-bold m-0 text-light" >Customers Based on Car Models</h6>
                                    <div class="dropdown no-arrow"><button class="btn btn-link btn-sm dropdown-toggle" aria-expanded="false" data-bs-toggle="dropdown" type="button"><i class="fas fa-ellipsis-v text-gray-400"></i></button>
                                        <div class="dropdown-menu shadow dropdown-menu-end animated--fade-in">
                                            <p class="text-center dropdown-header">dropdown header:</p><a class="dropdown-item" href="#">&nbsp;Action</a><a class="dropdown-item" href="#">&nbsp;Another action</a>
                                            <div class="dropdown-divider"></div><a class="dropdown-item" href="#">&nbsp;Something else here</a>
                                        </div>
                                    </div>
                                </div>
                                <div class="card-body">
                                    <div class="chart-area">
                                        <canvas data-bss-chart='{
                                           "type":"pie",
                                           "data":{
                                              "labels":["Toyota","Honda","Nissan", "Mitsubishi", "Ford", "Others"],
                                              "datasets":[{
                                                 "label":"",
                                                 "backgroundColor":["#FE5F55","#577399","#BDD5EA", "#BABAFF", "#FBABAA", "#495867"],
                                                 "borderColor":["#fff","#fff","#fff","#fff","#fff","#fff"],
                                                 "data":[55,23,16,14,33,16]
                                              }]
                                           },
                                           "options":{
                                              "maintainAspectRatio":false,
                                              "legend":{"display":true}
                                           }
                                        }'></canvas>
                                     </div>                                     
                                </div>
                            </div>
                        </div>

                        <div class="col-lg-5 col-xl-4"> <!--MAX OF Top 8 services-->
                            <div class="card shadow mb-4">
                                <div class="card-header d-flex justify-content-between align-items-center" style="background-color: rgb(0, 0, 0);">
                                <h6 class="text-primary fw-bold mb-1 mt-1 text-light" >Most Acquired Services</h6>
                                </div>
                                <table class="table table-bordered">
                                    <thead style="color: rgb(92, 0, 0); font-weight: bold;">
                                        <tr>
                                            <th>Service Name</th>
                                            <th>Acquisition</th>
                                            
                                        </tr>
                                    </thead>
                                    <tbody id="service-table-body" style="background-color: white; color: rgb(45, 45, 45);">
                                        <!-- Data will be inserted dynamically -->
                                    </tbody>
                                </table>
                            
                            </div>

                        </div>
                        

                        <div class="col-lg-5 col-xl-4">
                            <div class="card shadow mb-4">
                                <div class="card-header d-flex justify-content-between align-items-center" style="background-color: darkred;">
                                    <h6 class="text-primary fw-bold m-0 text-light" >Top Performing Mechanics</h6>
                                    <div class="dropdown no-arrow"><button class="btn btn-link btn-sm dropdown-toggle" aria-expanded="false" data-bs-toggle="dropdown" type="button"><i class="fas fa-ellipsis-v text-gray-400"></i></button>
                                        <div class="dropdown-menu shadow dropdown-menu-end animated--fade-in">
                                            <p class="text-center dropdown-header">dropdown header:</p><a class="dropdown-item" href="#">&nbsp;Action</a><a class="dropdown-item" href="#">&nbsp;Another action</a>
                                            <div class="dropdown-divider"></div><a class="dropdown-item" href="#">&nbsp;Something else here</a>
                                        </div>
                                    </div>
                                </div>
                                <div class="card-body">
                                    <div class="chart-area">
                                        <canvas data-bss-chart='{
                                           "type":"pie",
                                           "data":{
                                              "labels":["M1","M2","M3", "M4", "M5", "M6"],
                                              "datasets":[{
                                                 "label":"",
                                                 "backgroundColor":["#FE5F55","#577399","#BDD5EA", "#BABAFF", "#FBABAA", "#495867"],
                                                 "borderColor":["#fff","#fff","#fff","#fff","#fff","#fff"],
                                                 "data":[55,23,16,14,33,16]
                                              }]
                                           },
                                           "options":{
                                              "maintainAspectRatio":false,
                                              "legend":{"display":true}
                                           }
                                        }'></canvas>
                                     </div>                                     
                                </div>
                            </div>
                        </div>
                    </div>
                </div> 
            </div>

           
        
            
            <footer class="bg-white sticky-footer">
                <div class="container my-auto">
                    <div class="text-center my-auto copyright"><span>Copyright Â© Logo 2024</span></div>
                </div>
            </footer>
        </div>
        <!-- 
<div id="chatbot">
    <button id="chatbotToggle">
      <img src="assets/img/chat-icon.png" alt="Chat" style="width: 30px; height: 30px;">
    </button>
    <div id="chatbox" class="hidden">
      <div id="chatHeader">
        <span>Chat with Us!</span>
        <button id="closeChat">X</button>
      </div>
      <div id="chatMessages" style="overflow-y: auto;"></div>
      <input id="chatInput" type="text" placeholder="Type a message..." />
      <button id="sendMessage">Send</button>
    </div>
</div>
-->
          
        <a class="border rounded d-inline scroll-to-top" href="#page-top"><i class="fas fa-angle-up"></i></a>
    </div>
    <script src="assets/bootstrap/js/bootstrap.min.js"></script>
    <script src="assets/js/chart.min.js"></script>
    <script src="assets/js/bs-init.js"></script>
    <script src="assets/js/theme.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            // Fetch data from the backend API
            const fetchData = async (url) => {
                try {
                    const response = await fetch(url);
                    if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);
                    const data = await response.json();
                    return data;
                } catch (error) {
                    console.error(`Error fetching data from ${url}:`, error);
                    return null;
                }
            };
    
            // Update dashboard dynamically
            const updateDashboard = async () => {
                // Fetch and update total registered customers
                const customerData = await fetchData('/api/analytics/customers');
                if (customerData) {
                    document.querySelector('.value span').textContent = customerData.totalCustomers || 0;
                }
    
                // Fetch and update pending appointments
                const pendingData = await fetchData('/api/analytics/appointments/pending');
                if (pendingData) {
                    document.querySelector('.value-pending span').textContent = pendingData.pendingCount || 0;
                }
    
                // Fetch and update approved appointments
                const approvedData = await fetchData('/api/analytics/appointments/approved');
                if (approvedData) {
                    document.querySelector('.value-approved span').textContent = approvedData.approvedCount || 0;
                }
    
                // Fetch and update archived appointments
                const archivedData = await fetchData('/api/analytics/appointments/archived');
                if (archivedData) {
                    document.querySelector('.value-archived span').textContent = archivedData.archivedCount || 0;
                }
    
                // Fetch and populate the most acquired services table
                const servicesData = await fetchData('/api/analytics/services/top');
                const tableBody = document.getElementById('service-table-body');
                tableBody.innerHTML = ''; // Clear the existing data
                if (servicesData && servicesData.topServices) {
                    servicesData.topServices.forEach(service => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${service._id}</td> <!-- Assuming '_id' contains the service name -->
                            <td>${service.count}</td> <!-- Assuming 'count' contains the acquisition count -->
                        `;
                        tableBody.appendChild(row);
                    });
                } else {
                    const row = document.createElement('tr');
                    row.innerHTML = `<td colspan="2">No data available</td>`;
                    tableBody.appendChild(row);
                }
            };
    
            // Call the function to update the dashboard
            updateDashboard();
        });

    </script>

    <script>
        const socket = io.connect("https://humorous-precisely-anchovy.ngrok-free.app", { query: { role: "admin" } });

document.getElementById("chatbotToggle").addEventListener("click", async () => {
  const chatbox = document.getElementById("chatbox");
  chatbox.classList.toggle("hidden");

  if (!chatbox.classList.contains("hidden")) {
    const messages = await fetchChatHistory(); // Fetch chat history
    messages.forEach((msg) => {
      displayMessage(msg.sender === "admin" ? "You" : "User", msg.content);
    });
  }
});

// Send message
document.getElementById("sendMessage").addEventListener("click", async () => {
  const chatInput = document.getElementById("chatInput");
  const message = chatInput.value.trim();

  if (message) {
    const sent = await sendMessage({ sender: "admin", content: message });
    if (sent) {
      displayMessage("You", message);
      chatInput.value = '';
    }
  }
});

// Listen for incoming messages
socket.on("newMessage", (message) => {
  displayMessage("User", message.content);
});

// Fetch chat history from backend
async function fetchChatHistory() {
  try {
    const response = await fetch("/api/chat/history?role=admin");
    if (!response.ok) throw new Error("Failed to fetch chat history");
    return await response.json();
  } catch (error) {
    console.error(error);
    return [];
  }
}

// Send message to backend
async function sendMessage(message) {
  try {
    const response = await fetch("/api/chat/send", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(message),
    });
    if (!response.ok) throw new Error("Failed to send message");
    return true;
  } catch (error) {
    console.error(error);
    return false;
  }
}

// Display a message in the chatbox
function displayMessage(sender, content) {
  const chatMessages = document.getElementById("chatMessages");
  const newMessage = document.createElement("div");
  newMessage.textContent = `${sender}: ${content}`;
  chatMessages.appendChild(newMessage);
  chatMessages.scrollTop = chatMessages.scrollHeight;
}

    </script>
        
</body>

</html>